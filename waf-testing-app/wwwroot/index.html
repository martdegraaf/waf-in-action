<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAF Testing Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .test-card {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .test-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #007bff;
        }

        .test-card.safe {
            border-left: 5px solid #28a745;
        }

        .test-card.attack {
            border-left: 5px solid #dc3545;
        }

        .test-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .test-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .test-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
            font-family: monospace;
        }

        .test-button {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 100%;
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.3);
        }

        .test-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.9em;
        }

        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .result.blocked {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .result.error {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-safe { background: #28a745; }
        .status-danger { background: #dc3545; }

        .logs-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }

        .logs-title {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #2c3e50;
        }

        .clear-logs {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            float: right;
        }

        .logs-container {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.9em;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 3px;
        }

        .log-success { background: rgba(40, 167, 69, 0.2); }
        .log-blocked { background: rgba(220, 53, 69, 0.2); }
        .log-error { background: rgba(255, 193, 7, 0.2); }

        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è WAF Testing Dashboard</h1>
            <p>Test Azure Application Gateway Web Application Firewall protection with OWASP 3.2 rules</p>
        </div>

        <div class="main-content">
            <div class="test-grid">
                <!-- Safe Tests -->
                <div class="test-card safe">
                    <div class="test-title">
                        <span class="status-indicator status-safe"></span>
                        Health Check
                    </div>
                    <div class="test-description">
                        Basic connectivity test to verify the application is running
                    </div>
                    <button class="test-button" onclick="testEndpoint('/', 'GET', null, this)">
                        Test Health Check
                    </button>
                    <div class="result" id="result-health"></div>
                </div>

                <div class="test-card safe">
                    <div class="test-title">
                        <span class="status-indicator status-safe"></span>
                        Safe API Call
                    </div>
                    <div class="test-description">
                        Normal API endpoint that should pass through WAF without issues
                    </div>
                    <button class="test-button" onclick="testEndpoint('/api/waftest/safe', 'GET', null, this)">
                        Test Safe Endpoint
                    </button>
                    <div class="result" id="result-safe"></div>
                </div>

                <!-- Attack Tests -->
                <div class="test-card attack">
                    <div class="test-title">
                        <span class="status-indicator status-danger"></span>
                        SQL Injection Attack
                    </div>
                    <div class="test-description">
                        Test SQL injection patterns that should be blocked by OWASP rules
                    </div>
                    <input type="text" class="test-input" id="sql-payload" value="1' OR '1'='1" placeholder="Enter SQL injection payload">
                    <button class="test-button" onclick="testSqlInjection(this)">
                        Test SQL Injection (Should be Blocked)
                    </button>
                    <div class="result" id="result-sql"></div>
                </div>

                <div class="test-card attack">
                    <div class="test-title">
                        <span class="status-indicator status-danger"></span>
                        XSS Attack
                    </div>
                    <div class="test-description">
                        Test cross-site scripting payloads that should be blocked
                    </div>
                    <input type="text" class="test-input" id="xss-payload" value="<script>alert('XSS')</script>" placeholder="Enter XSS payload">
                    <button class="test-button" onclick="testXss(this)">
                        Test XSS (Should be Blocked)
                    </button>
                    <div class="result" id="result-xss"></div>
                </div>

                <div class="test-card attack">
                    <div class="test-title">
                        <span class="status-indicator status-danger"></span>
                        Path Traversal Attack
                    </div>
                    <div class="test-description">
                        Test directory traversal attempts that should be blocked
                    </div>
                    <input type="text" class="test-input" id="path-payload" value="../../../etc/passwd" placeholder="Enter path traversal payload">
                    <button class="test-button" onclick="testPathTraversal(this)">
                        Test Path Traversal (Should be Blocked)
                    </button>
                    <div class="result" id="result-path"></div>
                </div>

                <div class="test-card attack">
                    <div class="test-title">
                        <span class="status-indicator status-danger"></span>
                        Bot Attack Simulation
                    </div>
                    <div class="test-description">
                        Test malicious bot patterns that should trigger Bot Manager rules
                    </div>
                    <button class="test-button" onclick="testBotAttack(this)">
                        Test Bot Attack (Should be Blocked)
                    </button>
                    <div class="result" id="result-bot"></div>
                </div>

                <div class="test-card attack">
                    <div class="test-title">
                        <span class="status-indicator status-danger"></span>
                        Command Injection
                    </div>
                    <div class="test-description">
                        Test command injection payloads that should be blocked
                    </div>
                    <input type="text" class="test-input" id="cmd-payload" value="; ls -la" placeholder="Enter command injection payload">
                    <button class="test-button" onclick="testCommandInjection(this)">
                        Test Command Injection (Should be Blocked)
                    </button>
                    <div class="result" id="result-cmd"></div>
                </div>

                <div class="test-card attack">
                    <div class="test-title">
                        <span class="status-indicator status-danger"></span>
                        Malicious Payload
                    </div>
                    <div class="test-description">
                        Test various malicious payloads that should be detected
                    </div>
                    <input type="text" class="test-input" id="malicious-payload" value="<%eval request%>" placeholder="Enter malicious payload">
                    <button class="test-button" onclick="testMaliciousPayload(this)">
                        Test Malicious Payload (Should be Blocked)
                    </button>
                    <div class="result" id="result-malicious"></div>
                </div>

                <!-- Real-Life Demo Tests -->
                <div class="test-card attack">
                    <div class="test-title">
                        <span class="status-indicator status-danger"></span>
                        üë§ Person Registration Demo
                    </div>
                    <div class="test-description">
                        Real-life test: Register a person named "Meneer Havinga" to see if WAF blocks legitimate Dutch names
                    </div>
                    <input type="text" class="test-input" id="person-name" value="Meneer Havinga" placeholder="Enter person name">
                    <input type="email" class="test-input" id="person-email" value="havinga@example.nl" placeholder="Enter email">
                    <button class="test-button" onclick="testPersonRegistration(this)">
                        Register Person (Real-Life Test)
                    </button>
                    <div class="result" id="result-person"></div>
                </div>

                <div class="test-card attack">
                    <div class="test-title">
                        <span class="status-indicator status-danger"></span>
                        üöó Vehicle Registration Demo
                    </div>
                    <div class="test-description">
                        Real-life test: Register a "LAND ROVER" vehicle to test WAF handling of legitimate automotive data
                    </div>
                    <input type="text" class="test-input" id="vehicle-brand" value="LAND ROVER" placeholder="Enter vehicle brand">
                    <input type="text" class="test-input" id="vehicle-model" value="Defender" placeholder="Enter vehicle model">
                    <input type="number" class="test-input" id="vehicle-year" value="2023" placeholder="Enter year">
                    <button class="test-button" onclick="testVehicleRegistration(this)">
                        Register Vehicle (Real-Life Test)
                    </button>
                    <div class="result" id="result-vehicle"></div>
                </div>

                <div class="test-card attack">
                    <div class="test-title">
                        <span class="status-indicator status-danger"></span>
                        üí¨ Comment Submission Demo
                    </div>
                    <div class="test-description">
                        Real-life test: Submit a comment with "---" dashes to test WAF handling of common text patterns
                    </div>
                    <textarea class="test-input" id="comment-text" placeholder="Enter comment" rows="3">Great product! Highly recommended --- would definitely buy again!</textarea>
                    <input type="text" class="test-input" id="comment-author" value="John Doe" placeholder="Enter author name">
                    <button class="test-button" onclick="testCommentSubmission(this)">
                        Submit Comment (Real-Life Test)
                    </button>
                    <div class="result" id="result-comment"></div>
                </div>
            </div>

            <div class="logs-section">
                <div class="logs-title">
                    Test Results Log
                    <button class="clear-logs" onclick="clearLogs()">Clear Logs</button>
                </div>
                <div class="logs-container" id="logs"></div>
            </div>
        </div>
    </div>

    <script>
        function addLog(message, type = 'info') {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logs.appendChild(logEntry);
            logs.scrollTop = logs.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        async function testEndpoint(endpoint, method = 'GET', params = null, button) {
            const originalText = button.textContent;
            button.textContent = 'Testing...';
            button.disabled = true;

            try {
                let url = endpoint;
                if (params) {
                    const searchParams = new URLSearchParams(params);
                    url += '?' + searchParams.toString();
                }

                const response = await fetch(url, { method });
                const responseText = await response.text();
                
                let resultElement = button.parentElement.querySelector('.result');
                let resultClass, logType, message;

                if (response.ok) {
                    resultClass = 'success';
                    logType = 'success';
                    message = `‚úÖ ${endpoint} - Status: ${response.status} - PASSED`;
                } else if (response.status === 403) {
                    resultClass = 'blocked';
                    logType = 'blocked';
                    message = `üö´ ${endpoint} - Status: ${response.status} - BLOCKED BY WAF`;
                } else {
                    resultClass = 'error';
                    logType = 'error';
                    message = `‚ö†Ô∏è ${endpoint} - Status: ${response.status} - UNEXPECTED`;
                }

                resultElement.className = `result ${resultClass}`;
                resultElement.innerHTML = `
                    <strong>Status:</strong> ${response.status}<br>
                    <strong>Response:</strong> ${responseText.substring(0, 200)}${responseText.length > 200 ? '...' : ''}
                `;

                addLog(message, logType);

            } catch (error) {
                const resultElement = button.parentElement.querySelector('.result');
                resultElement.className = 'result error';
                resultElement.innerHTML = `<strong>Error:</strong> ${error.message}`;
                addLog(`‚ùå ${endpoint} - Error: ${error.message}`, 'error');
            }

            button.textContent = originalText;
            button.disabled = false;
        }

        function testSqlInjection(button) {
            const payload = document.getElementById('sql-payload').value;
            testEndpoint('/api/waftest/sql-injection', 'GET', { userId: payload }, button);
        }

        function testXss(button) {
            const payload = document.getElementById('xss-payload').value;
            testEndpoint('/api/waftest/xss', 'GET', { comment: payload }, button);
        }

        function testPathTraversal(button) {
            const payload = document.getElementById('path-payload').value;
            testEndpoint('/api/waftest/path-traversal', 'GET', { filePath: payload }, button);
        }

        function testBotAttack(button) {
            // Test multiple bot patterns that should trigger Bot Manager
            const botTests = [
                // Test 1: Known bot user agents
                () => testEndpointWithHeaders('/api/waftest/bot-simulation', 'GET', {}, 
                    {'User-Agent': 'Googlebot/2.1 (+http://www.google.com/bot.html)'}),
                
                // Test 2: Suspicious scraping patterns
                () => testEndpointWithHeaders('/api/waftest/bot-simulation', 'GET', {}, 
                    {'User-Agent': 'python-requests/2.25.1', 'Accept': '*/*'}),
                
                // Test 3: Automated tool signatures
                () => testEndpointWithHeaders('/api/waftest/bot-simulation', 'GET', {}, 
                    {'User-Agent': 'curl/7.68.0'}),
                
                // Test 4: Suspicious rate limiting (rapid requests)
                () => rapidFireRequests('/api/waftest/bot-simulation', 10)
            ];

            // Try the most likely to be blocked first
            testEndpointWithHeaders('/api/waftest/bot-simulation', 'GET', {}, 
                {'User-Agent': 'BadBot/1.0 (automated scraper)'}, button);
        }

        async function testEndpointWithHeaders(endpoint, method, params, headers, button) {
            let originalText = '';
            if (button) {
                originalText = button.textContent;
                button.textContent = 'Testing...';
                button.disabled = true;
            }

            try {
                let url = endpoint;
                let requestOptions = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        ...headers
                    }
                };

                if (method === 'GET' && params && Object.keys(params).length > 0) {
                    const queryString = new URLSearchParams(params).toString();
                    url += '?' + queryString;
                } else if (method === 'POST' && params) {
                    requestOptions.body = JSON.stringify(params);
                }

                const response = await fetch(url, requestOptions);
                const responseText = await response.text();

                if (button) {
                    const resultElement = button.parentElement.querySelector('.result');
                    let resultClass, logType, message;

                    if (response.status === 200) {
                        resultClass = 'success';
                        logType = 'success';
                        message = `‚ö†Ô∏è ${endpoint} - Status: ${response.status} - Bot request was ALLOWED (Bot Manager may need time or different patterns)`;
                    } else if (response.status === 403) {
                        resultClass = 'blocked';
                        logType = 'info';
                        message = `üö´ ${endpoint} - Status: ${response.status} - BLOCKED BY BOT MANAGER`;
                    } else {
                        resultClass = 'error';
                        logType = 'error';
                        message = `‚ö†Ô∏è ${endpoint} - Status: ${response.status} - UNEXPECTED`;
                    }

                    resultElement.className = `result ${resultClass}`;
                    resultElement.innerHTML = `
                        <strong>Status:</strong> ${response.status}<br>
                        <strong>Headers Sent:</strong> ${JSON.stringify(headers)}<br>
                        <strong>Response:</strong> ${responseText.substring(0, 200)}${responseText.length > 200 ? '...' : ''}
                    `;

                    addLog(message, logType);
                }

            } catch (error) {
                if (button) {
                    const resultElement = button.parentElement.querySelector('.result');
                    resultElement.className = 'result error';
                    resultElement.innerHTML = `<strong>Error:</strong> ${error.message}`;
                    addLog(`‚ùå ${endpoint} - Error: ${error.message}`, 'error');
                }
            }

            if (button) {
                button.textContent = originalText;
                button.disabled = false;
            }
        }

        async function rapidFireRequests(endpoint, count) {
            const promises = [];
            for (let i = 0; i < count; i++) {
                promises.push(fetch(endpoint, {
                    headers: {'User-Agent': 'RapidBot/1.0'}
                }));
            }
            
            try {
                const responses = await Promise.all(promises);
                const blockedCount = responses.filter(r => r.status === 403).length;
                addLog(`üî• Rapid fire test: ${blockedCount}/${count} requests blocked`, 'info');
            } catch (error) {
                addLog(`‚ùå Rapid fire test failed: ${error.message}`, 'error');
            }
        }

        function testCommandInjection(button) {
            const payload = document.getElementById('cmd-payload').value;
            testEndpoint('/api/waftest/command-injection', 'GET', { command: payload }, button);
        }

        function testMaliciousPayload(button) {
            const payload = document.getElementById('malicious-payload').value;
            testEndpoint('/api/waftest/malicious-payload', 'GET', { payload: payload }, button);
        }

        function testPersonRegistration(button) {
            const name = document.getElementById('person-name').value;
            const email = document.getElementById('person-email').value;
            
            const data = {
                name: name,
                email: email
            };
            
            testPostEndpoint('/api/waftest/person-registration', data, button);
        }

        function testVehicleRegistration(button) {
            const brand = document.getElementById('vehicle-brand').value;
            const model = document.getElementById('vehicle-model').value;
            const year = parseInt(document.getElementById('vehicle-year').value) || 2023;
            
            const data = {
                brand: brand,
                model: model,
                year: year
            };
            
            testPostEndpoint('/api/waftest/vehicle-registration', data, button);
        }

        function testCommentSubmission(button) {
            const comment = document.getElementById('comment-text').value;
            const author = document.getElementById('comment-author').value;
            
            const data = {
                comment: comment,
                author: author
            };
            
            testPostEndpoint('/api/waftest/comment-submission', data, button);
        }

        async function testPostEndpoint(endpoint, data, button) {
            const originalText = button.textContent;
            button.textContent = 'Testing...';
            button.disabled = true;

            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const responseText = await response.text();
                
                let resultElement = button.parentElement.querySelector('.result');
                let resultClass, logType, message;

                if (response.ok) {
                    resultClass = 'success';
                    logType = 'success';
                    message = `‚úÖ ${endpoint} - Status: ${response.status} - ALLOWED (Real-life data passed WAF)`;
                } else if (response.status === 403) {
                    resultClass = 'blocked';
                    logType = 'blocked';
                    message = `üö´ ${endpoint} - Status: ${response.status} - BLOCKED BY WAF (False positive?)`;
                } else {
                    resultClass = 'error';
                    logType = 'error';
                    message = `‚ö†Ô∏è ${endpoint} - Status: ${response.status} - UNEXPECTED`;
                }

                resultElement.className = `result ${resultClass}`;
                resultElement.innerHTML = `
                    <strong>Status:</strong> ${response.status}<br>
                    <strong>Sent Data:</strong> ${JSON.stringify(data, null, 2)}<br>
                    <strong>Response:</strong> ${responseText.substring(0, 300)}${responseText.length > 300 ? '...' : ''}
                `;

                addLog(message, logType);

            } catch (error) {
                const resultElement = button.parentElement.querySelector('.result');
                resultElement.className = 'result error';
                resultElement.innerHTML = `<strong>Error:</strong> ${error.message}`;
                addLog(`‚ùå ${endpoint} - Error: ${error.message}`, 'error');
            }

            button.textContent = originalText;
            button.disabled = false;
        }

        // Initialize logs
        addLog('WAF Testing Dashboard initialized - Ready to test!', 'success');
    </script>
</body>
</html>
